tinymce.PluginManager.add('slashcmd', function (editor) {
    var insertActions = [
        /*{
            text: 'Heading 1',
            icon: 'H1',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h1');
            }
        },*/
        {
            text: 'Heading 2',  
            icon: 'H2',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h2');
            }
        },
        {
            text: 'Heading 3',
            icon: 'H3',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h3');
            }
        },
        {
            text: 'Heading 4',
            icon: 'H4',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h4');
            }
        },
        /*{
            text: 'Heading 5',
            icon: 'H5',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h5');
            }
        },
        {
            text: 'Heading 6',
            icon: 'H6',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h6');
            }
        },*/
        {
            type:'separator'
        },
        {
            text: 'Quote',
            icon: 'quote',
            action: function () {
                editor.execCommand('mceBlockQuote', false);
            }
        },
        {
            text: 'Bulleted list',
            icon: 'unordered-list',
            action: function () {
                editor.execCommand('InsertUnorderedList', false);
            }
        },
        {
            text: 'Numbered list',
            icon: 'ordered-list',
            action: function () {
                editor.execCommand('InsertOrderedList', false);
            }
        },
        {
            type: 'separator'
        },
    ];

    // Register the slash commands autocompleter
    editor.ui.registry.addAutocompleter('slashcmd', {
        trigger: '/',
        minChars: 0,
        columns: 1,
        fetch: function (pattern) {
            const matchedActions = insertActions.filter(function (action) {
                return action.type === 'separator' ||
                    action.text.toLowerCase().indexOf(pattern.toLowerCase()) !== -1;
            });

            return new Promise((resolve) => {
                var results = matchedActions.map(function (action) {
                    return {
                        meta: action,
                        text: action.text,
                        icon: action.icon,
                        value: action.text,
                        type: action.type
                    }
                });
                resolve(results);
            });
        },
        onAction: function (autocompleteApi, rng, action, meta) {
            editor.selection.setRng(rng);
            // Some actions don't delete the "slash", so we delete all the slash
            // command content before performing the action
            editor.execCommand('Delete');
            /*
            //判断删除/后，最后的字符是否为空格
            const newrng = editor.selection.getRng(); // 获取当前光标范围
            const container = newrng.startContainer; // 光标所在的节点
            const offset = newrng.startOffset; // 光标在节点内的偏移量
            const text = container.textContent; // 节点的完整文本内容
            const start = Math.max(0, offset - 1); // 计算起始位置（避免越界）
            let lastchar = text.substring(start, offset); // 截取最后1个字符
            if(/^[\s]$/.test(lastchar)){
                editor.execCommand('Delete');
            }
            */
            meta.action();
            autocompleteApi.hide(); 
        }
    });
    return {};
});