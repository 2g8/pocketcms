tinymce.PluginManager.add('slashcmd', function (editor) {
    var insertActions = [
        {
            text: 'Heading 1',
            icon: 'H1',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h1');
            }
        },
        {
            text: 'Heading 2',  
            icon: 'H2',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h2');
            }
        },
        {
            text: 'Heading 3',
            icon: 'H3',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h3');
            }
        },
        {
            text: 'Heading 4',
            icon: 'H4',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h4');
            }
        },
        {
            text: 'Heading 5',
            icon: 'H5',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h5');
            }
        },
        {
            text: 'Heading 6',
            icon: 'H6',
            action: function () {
                editor.execCommand('FormatBlock', false, 'h6');
            }
        },
        {
            text: 'Quote',
            icon: 'quote',
            action: function () {
                editor.execCommand('mceBlockQuote', false);
            }
        },
        {
            text: 'Bulleted list',
            icon: 'unordered-list',
            action: function () {
                editor.execCommand('InsertUnorderedList', false);
            }
        },
        {
            text: 'Numbered list',
            icon: 'ordered-list',
            action: function () {
                editor.execCommand('InsertOrderedList', false);
            }
        },
        {
            type: 'separator'
        },
    ];

    // Register the slash commands autocompleter
    editor.ui.registry.addAutocompleter('slashcmd', {
        trigger: '/',
        minChars: 0,
        columns: 6,
        fetch: function (pattern) {
            const matchedActions = insertActions.filter(function (action) {
                return action.type === 'separator' ||
                    action.text.toLowerCase().indexOf(pattern.toLowerCase()) !== -1;
            });

            return new Promise((resolve) => {
                var results = matchedActions.map(function (action) {
                    return {
                        meta: action,
                        text: action.text,
                        icon: action.icon,
                        value: action.text,
                        type: action.type
                    }
                });
                resolve(results);
            });
        },
        onAction: function (autocompleteApi, rng, action, meta) {
            editor.selection.setRng(rng);
            // Some actions don't delete the "slash", so we delete all the slash
            // command content before performing the action
            editor.execCommand('Delete');
            meta.action();
            autocompleteApi.hide(); 
        }
    });
    return {};
});